//define shared library
@Library('Jenkins-shared@feature/tf') _

//start of npipeline
pipeline{
      agent any

      environment {
        GOOGLE_APPLICATION_CREDENTIALS = ''
      }

      stages{
        stage('Configure'){
          steps{
            withCredentials([file(credentialsId: 'SA_AUTH',variable: 'SERVICE_ACCOUNT_KEY')]) {
              
              println("${SERVICE_ACCOUNT_KEY}") 
              script{
                env.GOOGLE_APPLICATION_CREDENTIALS=${SERVICE_ACCOUNT_KEY}
                echo "Service account key configured: ${env.GOOGLE_APPLICATION_CREDENTIALS}"
                        
                // Check if the file exists
                sh 'ls -l $GOOGLE_APPLICATION_CREDENTIALS'
              }           
            }
          }
        }

        stage('Init') {
          steps {
            script {
              terraform.init(terraformDir: 'GCP/compute_instance')
            }
          }
        }

        stage('Plan') {
            steps {
                script {
                    terraform.plan(terraformDir: 'GCP/compute_instance')
                }
            }
        }



    }
}